<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>12小時制互動時鐘</title>
    <style>
        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: #f5f6fa;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        .container {
            max-width: 400px;
            margin: 32px auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.07);
            padding: 24px 10px 18px 10px;
        }
        h2 {
            margin-top: 0;
            color: #2d405e;
        }
        .inputs, .time-adjust {
            display: flex;
            justify-content: center;
            gap: 9px;
            margin-bottom: 14px;
            align-items: center;
            flex-wrap: wrap;
        }
        label {
            font-size: 1.05em;
            color: #596275;
        }
        select {
            font-size: 1.1em;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid #d1d8e0;
            min-width: 44px;
        }
        .ampm-btn {
            font-size: 1.08em;
            background-color: #dff9fb;
            border: none;
            border-radius: 5px;
            margin-left: 4px;
            margin-right: 4px;
            padding: 4px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .ampm-btn.active {
            background-color: #3867d6;
            color: #fff;
            font-weight: bold;
        }
        .adj-btn {
            font-size: 1.22em;
            background: #f8a5c2;
            color: #2d405e;
            border: none;
            border-radius: 4px;
            width: 28px;
            height: 28px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.18s;
        }
        .adj-btn:active {
            background: #f78fb3;
        }
        .clock {
            margin: 0 auto;
            display: block;
            width: 240px;
            max-width: 95vw;
            touch-action: none;
            user-select: none;
        }
        .digital-time {
            font-size: 2.1em;
            font-family: 'Segoe UI Mono', monospace;
            margin: 8px 0 12px 0;
            color: #222f3e;
            letter-spacing: 0.08em;
        }
        @media (max-width: 400px) {
            .container { padding: 10px 2vw 14px 2vw;}
            .clock { width: 160px;}
            .digital-time { font-size: 1.5em;}
        }
        .tip {
            color: #aaa;
            font-size: .97em;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>12小時制互動時鐘</h2>
        <div class="digital-time" id="digitalTime">03:12 PM</div>
        <div class="inputs">
            <label>
                小時：
                <select id="hour"></select>
            </label>
            <label>
                分鐘：
                <select id="minute"></select>
            </label>
            <button id="amBtn" class="ampm-btn">AM</button>
            <button id="pmBtn" class="ampm-btn">PM</button>
        </div>
        <div class="time-adjust">
            <button class="adj-btn" id="hourMinus">-</button>
            <span>小時</span>
            <button class="adj-btn" id="hourPlus">+</button>
            <button class="adj-btn" id="minuteMinus">-</button>
            <span>分鐘</span>
            <button class="adj-btn" id="minutePlus">+</button>
        </div>
        <svg class="clock" viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="90" fill="#f7f1e3" stroke="#2d405e" stroke-width="4"/>
            <!-- 刻度 -->
            <g id="marks"></g>
            <!-- 數字 -->
            <g id="numbers"></g>
            <!-- 指針 -->
            <line id="hourHand" x1="100" y1="100" x2="100" y2="55" stroke="#3867d6" stroke-width="7" stroke-linecap="round"/>
            <line id="minuteHand" x1="100" y1="100" x2="100" y2="35" stroke="#fc5c65" stroke-width="4" stroke-linecap="round" style="cursor: pointer;"/>
            <circle cx="100" cy="100" r="7" fill="#2d405e"/>
        </svg>
        <div class="tip">可拖動紅色分針來改變分鐘</div>
    </div>
    <script>
        // ========= 音效 =========
        function playTick() {
            if (!window.AudioContext && !window.webkitAudioContext) return;
            const ctx = window._ac || new (window.AudioContext || window.webkitAudioContext)();
            window._ac = ctx;
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.type = "triangle";
            o.frequency.value = 880;
            g.gain.value = 0.13;
            o.connect(g).connect(ctx.destination);
            o.start();
            setTimeout(() => {
                g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.09);
                o.stop(ctx.currentTime + 0.1);
            }, 30);
        }
        function playDing() {
            if (!window.AudioContext && !window.webkitAudioContext) return;
            const ctx = window._ac || new (window.AudioContext || window.webkitAudioContext)();
            window._ac = ctx;
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.type = "sine";
            o.frequency.value = 1760;
            g.gain.value = 0.19;
            o.connect(g).connect(ctx.destination);
            o.start();
            setTimeout(() => {
                g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.15);
                o.stop(ctx.currentTime + 0.18);
            }, 30);
        }

        // =========== DOM  ===========
        const hourSel = document.getElementById('hour');
        const minuteSel = document.getElementById('minute');
        const amBtn = document.getElementById('amBtn');
        const pmBtn = document.getElementById('pmBtn');
        const hourHand = document.getElementById('hourHand');
        const minuteHand = document.getElementById('minuteHand');
        const marks = document.getElementById('marks');
        const numbers = document.getElementById('numbers');
        const digitalTime = document.getElementById('digitalTime');
        const hourMinus = document.getElementById('hourMinus');
        const hourPlus  = document.getElementById('hourPlus');
        const minuteMinus = document.getElementById('minuteMinus');
        const minutePlus  = document.getElementById('minutePlus');

        let isAM = true;

        // 產生小時/分鐘選單
        for(let h=1; h<=12; h++) {
            let option = document.createElement('option');
            option.value = h;
            option.text = h;
            hourSel.add(option);
        }
        for(let m=0; m<60; m++) {
            let option = document.createElement('option');
            option.value = m;
            option.text = (m<10?'0':'') + m;
            minuteSel.add(option);
        }

        // 產生刻度
        for(let i=0; i<60; i++) {
            let angle = (i * 6) * Math.PI / 180;
            let r1 = (i%5 === 0)? 80 : 88;
            let r2 = 90;
            let x1 = 100 + r1 * Math.sin(angle);
            let y1 = 100 - r1 * Math.cos(angle);
            let x2 = 100 + r2 * Math.sin(angle);
            let y2 = 100 - r2 * Math.cos(angle);

            let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', i%5===0 ? '#2d405e' : '#b2bec3');
            line.setAttribute('stroke-width', i%5===0 ? 3 : 1.2);
            marks.appendChild(line);
        }
        // 產生數字
        for(let n=1; n<=12; n++) {
            let angle = (n * 30 - 90) * Math.PI / 180;
            let x = 100 + 68 * Math.cos(angle);
            let y = 100 + 68 * Math.sin(angle) + 7;
            let text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', x);
            text.setAttribute('y', y);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('font-size', '19');
            text.setAttribute('fill', '#222f3e');
            text.setAttribute('font-weight', 'bold');
            text.textContent = n;
            numbers.appendChild(text);
        }

        // 取得現在時間，轉12小時制
        function getNow12() {
            const now = new Date();
            let hour = now.getHours();
            isAM = hour < 12;
            if (hour === 0) hour = 12;
            else if (hour > 12) hour -= 12;
            hourSel.value = hour;
            minuteSel.value = now.getMinutes();
            updateAMPM();
        }
        function updateAMPM() {
            amBtn.classList.toggle('active', isAM);
            pmBtn.classList.toggle('active', !isAM);
        }
        // 數字時刻
        function updateDigital() {
            let h = parseInt(hourSel.value);
            let m = parseInt(minuteSel.value);
            let h2 = h<10 ? "0"+h : h;
            let m2 = m<10 ? "0"+m : m;
            let ap = isAM ? "AM" : "PM";
            digitalTime.textContent = ${h2}:${m2} ${ap};
        }
        // 時鐘顯示
        function updateClock() {
            const hour = parseInt(hourSel.value);
            const minute = parseInt(minuteSel.value);

            // 小時指針
            const hourDeg = ((hour % 12) + minute / 60) * 30 - 90;
            const hourRad = hourDeg * Math.PI / 180;
            const hx = 100 + 45 * Math.cos(hourRad);
            const hy = 100 + 45 * Math.sin(hourRad);
            hourHand.setAttribute('x2', hx);
            hourHand.setAttribute('y2', hy);

            // 分鐘指針
            const minDeg = (minute * 6) - 90;
            const minRad = minDeg * Math.PI / 180;
            const mx = 100 + 62 * Math.cos(minRad);
            const my = 100 + 62 * Math.sin(minRad);
            minuteHand.setAttribute('x2', mx);
            minuteHand.setAttribute('y2', my);

            updateDigital();
        }

        function setHour(val) {
            let h = parseInt(hourSel.value);
            h += val;
            if (h < 1) h = 12;
            if (h > 12) h = 1;
            hourSel.value = h;
            playTick();
            updateClock();
        }
        function setMinute(val) {
            let m = parseInt(minuteSel.value);
            let h = parseInt(hourSel.value);
            let prevM = m;
            m += val;
            let overflow = 0;
            if (m >= 60) { m -= 60; overflow = 1;}
            if (m < 0) { m += 60; overflow = -1;}
            if (overflow !== 0) {
                setHour(overflow);
                playDing();
            } else {
                playTick();
            }
            hourSel.value = parseInt(hourSel.value); // 防止字串
            minuteSel.value = m;
            updateClock();
        }

        hourSel.addEventListener('change', ()=>{ playTick(); updateClock();});
        minuteSel.addEventListener('change', ()=>{ playTick(); updateClock(); });

        amBtn.addEventListener('click', () => {
            isAM = true;
            playDing();
            updateAMPM();
            updateClock();
        });
        pmBtn.addEventListener('click', () => {
            isAM = false;
            playDing();
            updateAMPM();
            updateClock();
        });

        hourMinus.addEventListener('click', ()=>setHour(-1));
        hourPlus.addEventListener('click', ()=>setHour(1));
        minuteMinus.addEventListener('click', ()=>setMinute(-1));
        minutePlus.addEventListener('click', ()=>setMinute(1));

        // 拖曳分針
        let dragging = false;
        let lastMinute = null;
        function getMouseAngle(evt) {
            let rect = minuteHand.ownerSVGElement.getBoundingClientRect();
            let x, y;
            if (evt.touches) {
                x = evt.touches[0].clientX;
                y = evt.touches[0].clientY;
            } else {
                x = evt.clientX;
                y = evt.clientY;
            }
            let cx = rect.left + rect.width / 2;
            let cy = rect.top + rect.height / 2;
            let dx = x - cx;
            let dy = y - cy;
            let angle = Math.atan2(dy, dx) * 180 / Math.PI;
            angle = (angle + 450) % 360; // 0度在12點鐘方向
            return angle;
        }
        function onPointerDown(evt) {
            evt.preventDefault();
            dragging = true;
            lastMinute = parseInt(minuteSel.value);
            document.body.style.cursor = "pointer";
        }
        function onPointerMove(evt) {
            if (!dragging) return;
            let angle = getMouseAngle(evt);
            let minute = Math.round(angle / 6) % 60;
            if (minute < 0) minute += 60;
            let prev = parseInt(minuteSel.value);
            let delta = minute - prev;

            // 處理跨越 0/59 跳小時
            if (Math.abs(delta) > 30) { // 例如59→0或0→59
                if (delta > 0) {
                    setHour(-1);
                } else {
                    setHour(1);
                }
            }
            minuteSel.value = minute;
            playTick();
            updateClock();
            lastMinute = minute;
        }
        function onPointerUp(evt) {
            if (!dragging) return;
            dragging = false;
            document.body.style.cursor = "";
            lastMinute = null;
        }

        // 支援鼠標與觸控
        minuteHand.addEventListener('mousedown', onPointerDown);
        window.addEventListener('mousemove', onPointerMove);
        window.addEventListener('mouseup', onPointerUp);

        minuteHand.addEventListener('touchstart', onPointerDown, {passive: false});
        window.addEventListener('touchmove', onPointerMove, {passive: false});
        window.addEventListener('touchend', onPointerUp, {passive: false});

        // 初始化
        getNow12();
        updateClock();
    </script>
</body>
</html>
